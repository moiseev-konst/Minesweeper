(()=>{"use strict";function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var t=function(){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.gameSize=e,this.mapLength=this.gameSize.row*this.gameSize.column,this.quantityMine=n,this.gameMap=[],this.gameMine=[],this.arrayOpenCells=[],this.subscribes=[],this.arrayFlagCells=[],this.firstClick,this.endGame,this.explosion,this.timerValue=0,this.initGame=!1,this.gameSelected=!1}var n,i;return n=t,(i=[{key:"getState",value:function(){return{gameSize:this.gameSize,mapLength:this.mapLength,quantityMine:this.quantityMine,gameMap:this.gameMap,gameMine:this.gameMine,arrayOpenCells:this.arrayOpenCells,arrayFlagCells:this.arrayFlagCells,firstClick:this.firstClick,endGame:this.endGame,explosion:this.explosion,timerValue:this.timerValue,initGame:this.initGame,gameSelected:this.gameSelected}}},{key:"setNewMap",value:function(e,t){this.gameSize=e,this.mapLength=this.gameSize.row*this.gameSize.column,this.quantityMine=t,this.deliver(this.getState())}},{key:"setNewGame",value:function(){this.gameMap=[],this.gameMine=[],this.arrayOpenCells=[],this.arrayFlagCells=[],this.firstClick=void 0,this.endGame=void 0,this.explosion=void 0,this.timerValue=0,this.deliver(this.getState())}},{key:"setStateFirstClick",value:function(e,t){this.firstClick=e,this.arrayOpenCells=t,this.deliver(this.getState())}},{key:"setStateLeftClick",value:function(e){this.arrayOpenCells=e,this.deliver(this.getState())}},{key:"setStateRightClick",value:function(e){this.arrayFlagCells=e,this.deliver(this.getState())}},{key:"setStateArray",value:function(e){this.arrayOpenCells=this.arrayOpenCells.concat(e).sort(),this.deliver(this.getState())}},{key:"setStateEndGame",value:function(e,t,n){this.endGame=e,void 0!==n?(this.explosion=n,this.arrayOpenCells=t):this.arrayOpenCells=t,this.deliver(this.getState())}},{key:"setStateMap",value:function(e){this.gameMap=e.gameMap,this.gameMine=e.gameMine,this.deliver(this.getState())}},{key:"setTimerValue",value:function(e,t){this.timerValue=Number.parseInt(e/1e3),t(this.getState())}},{key:"setGameInited",value:function(){this.initGame=!0,this.deliver(this.getState())}},{key:"setSelectGame",value:function(e){this.gameSelected=e,this.deliver(this.getState())}},{key:"addSubscribes",value:function(e){this.subscribes.push(e)}},{key:"deliver",value:function(e){this.subscribes.forEach((function(t){t(e)}))}}])&&e(n.prototype,i),t}();function n(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var s=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),a(this,"getState",(function(e){t.gameSize=e.gameSize,t.quantityMine=e.quantityMine,t.gameMap=e.gameMap,t.gameMine=e.gameMine,t.mapLength=t.gameSize.row*t.gameSize.column,t.findZeroElements=[]})),a(this,"sendMap",(function(){})),this.gameSize,this.mapLength,this.quantityMine,this.gameMap,this.gameMine,this.coordinateSurroundingElements=[{x:-1,y:0},{x:-1,y:-1},{x:0,y:-1},{x:1,y:-1},{x:1,y:0},{x:1,y:1},{x:0,y:1},{x:-1,y:1}],this.findZeroElements=[]}var t,i;return t=e,i=[{key:"createGameMap",value:function(e){if(this.getState(e),this.createMap(),void 0===e.firstClick){var t={gameMap:this.gameMap,gameMine:this.gameMine};this.sendMap(t)}else{this.writeMine(e.firstClick),this.writeNumberToMap();var n={gameMap:this.gameMap,gameMine:this.gameMine};this.sendMap(n)}}},{key:"createMap",value:function(){for(var e=0;e<this.mapLength;e++)this.gameMap[e]=0}},{key:"writeMine",value:function(e){for(;this.gameMine.length<this.quantityMine;){var t=Number.parseInt(this.mapLength*Math.random()+1);t!==e&&t<=this.mapLength-1&&this.gameMine.indexOf(t)<0&&this.gameMine.push(t)}}},{key:"writeNumberToMap",value:function(){var e=this;this.gameMine.forEach((function(t){e.gameMap[t]=-1,e.findSurroundElements(t).forEach((function(t){e.gameMap[t]>=0&&(e.gameMap[t]+=1)}))}))}},{key:"parseIndexToCoordinates",value:function(e){var t=Number.parseInt(e/this.gameSize.column);return{row:t,column:e-t*this.gameSize.column,index:e}}},{key:"parseCoordinatesToIndex",value:function(e){return e.row*this.gameSize.column+e.column}},{key:"findSurroundElements",value:function(e){var t=this,n=this.parseIndexToCoordinates(e);return this.coordinateSurroundingElements.filter((function(e){return n.row+e.x>=0&&n.row+e.x<=t.gameSize.row-1&&n.column+e.y>=0&&n.column+e.y<=t.gameSize.column-1})).map((function(e){return t.parseCoordinatesToIndex({row:n.row+e.x,column:n.column+e.y})}))}},{key:"findSurroundingZero",value:function(e){var t=this;return this.findSurroundElements(e).forEach((function(e){t.findZeroElements.indexOf(e)<0&&(t.findZeroElements.push(e),0==t.gameMap[e]&&t.findSurroundingZero(e))})),this.findZeroElements.indexOf(e)<0&&this.findZeroElements.push(e),this.findZeroElements}},{key:"findAllMine",value:function(){for(var e=[],t=0;t<this.gameMap.length;t++)this.gameMap[t]<0&&e.push(t);return e}}],i&&n(t.prototype,i),e}();function l(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var o=function(){function e(t,n,i){var a=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),r(this,"render",(function(){})),r(this,"watchRender",(function(){})),r(this,"getState",(function(e){a.gameSize=e.gameSize,a.mapLength=e.gameSize.row*e.gameSize.column,a.arrayOpenCells=e.arrayOpenCells,a.arrayFlagCells=e.arrayFlagCells,a.gameMap=e.gameMap,a.endGame=e.endGame,a.explosion=e.explosion,a.timerValue=e.timerValue,a.quantityMine=e.quantityMine,a.gameSelected=e.gameSelected})),this.gameSize,this.mapLength,this.collectionDivMap=[],this.gameMapHTML=t,this.countMine=i,this.watch=n,this.arrayOpenCells,this.arrayFlagCells,this.gameMap,this.endGame,this.explosion,this.timerValue,this.quantityMine,this.gameSelected,this.gameSelectionButton=[],this.choise}var t,n;return t=e,n=[{key:"createGameDiv",value:function(e){this.clear(),this.getState(e),this.gameSelected||this.renderGameSelection(),this.createCollectionDiv(),this.renderingMap(),this.appendDiv(),null!=this.endGame&&this.renderEndGame(this.endGame)}},{key:"getIndexDiv",value:function(e){return this.collectionDivMap.indexOf(e)}},{key:"getButton",value:function(e){var t=this.gameSelectionButton.indexOf(e);return this.renderGameSelection(),t}},{key:"getCollectionDiv",value:function(){return this.collectionDivMap}},{key:"clear",value:function(){this.gameMapHTML.innerHTML="",this.collectionDivMap=[]}},{key:"createDiv",value:function(){var e=document.createElement("div");return e.classList.add("GameElement"),e}},{key:"createCollectionDiv",value:function(){for(var e=0;e<this.mapLength;e++)this.collectionDivMap.push(this.createDiv())}},{key:"appendDiv",value:function(){var e=document.createDocumentFragment();this.collectionDivMap.forEach((function(t){e.appendChild(t)})),this.gameMapHTML.append(e)}},{key:"renderCountMine",value:function(){var e="".concat(this.quantityMine-this.arrayFlagCells.length);this.countMine.innerText="";var t=document.createElement("p");t.textContent=e,this.countMine.appendChild(t)}},{key:"renderWatch",value:function(e){var t;this.getState(e);var n=this.timerValue%60<10?"0"+Math.trunc(this.timerValue%60):Math.trunc(this.timerValue%60).toString(),i=this.timerValue/60%60<10?"0"+Math.trunc(this.timerValue/60%60):Math.trunc(this.timerValue/60%60).toString();t="".concat(i,":").concat(n),this.watch.innerText="";var a=document.createElement("p");a.textContent=t,this.watch.appendChild(a)}},{key:"renderingMap",value:function(){this.renderFlag(),this.renderCells(),this.renderCountMine()}},{key:"renderGameSelection",value:function(){var e=this;if(this.gameSelected)this.choise.remove(),this.gameSelectionButton=[],this.choise=null;else{this.gameMapHTML.innerHTML="",this.choise=null,this.gameSelectionButton=[],this.choise=document.createElement("div");var t=document.createElement("div"),n=document.createElement("div"),i=document.createElement("div");this.choise.classList.add("choice"),t.classList.add("btneasy"),n.classList.add("btnmedium"),i.classList.add("btnhard"),t.innerText="easy",n.innerText="medium",i.innerText="hard",i.id="btnhard",t.id="btneasy",n.id="btnmedium",this.gameSelectionButton.push(t),this.gameSelectionButton.push(n),this.gameSelectionButton.push(i),this.gameSelectionButton.map((function(t){return e.choise.appendChild(t)})),this.gameMapHTML.append(this.choise),this.gameSelected=!0}}},{key:"renderEndGame",value:function(e){var t=document.createElement("div");t.classList.add("endGame");var n="win"==e?"You won the battle!!!":"You lose, sucker!";t.innerText=n,this.gameMapHTML.append(t),t.addEventListener("click",(function e(){t.remove(),t.removeEventListener("click",e)}))}},{key:"renderFlag",value:function(){for(var e=0;e<this.arrayFlagCells.length;e++)this.collectionDivMap[this.arrayFlagCells[e]].classList.add("flag")}},{key:"renderCells",value:function(){for(var e=0;e<this.arrayOpenCells.length;e++)this.collectionDivMap[this.arrayOpenCells[e]].classList.length<2&&(this.explosion!=this.arrayOpenCells[e]?this.collectionDivMap[this.arrayOpenCells[e]].classList.add(this.selectСlassCss(this.arrayOpenCells[e])):this.collectionDivMap[this.arrayOpenCells[e]].classList.add("n9"))}},{key:"selectСlassCss",value:function(e){return this.gameMap[e]>=0?"n".concat(this.gameMap[e]):"mine"}},{key:"addClassCssController",value:function(e,t){if(Number.isInteger(t)){var n="n".concat(t);this.addClassCss(e,n)}else"flag"!=t||e.classList.contains("n0")||e.classList.contains("n1")||e.classList.contains("n2")||e.classList.contains("n3")||e.classList.contains("n4")||e.classList.contains("n5")||e.classList.contains("n6")||e.classList.contains("n7")||e.classList.contains("n8")||e.classList.contains("n9")||e.classList.contains("mine")?"mine"!=t||e.classList.contains("flag")||e.classList.contains("n9")?"n9"==t&&this.addClassCss(e,t):this.addClassCss(e,t):(e.classList.contains(t)?(e.classList.remove(t),this.countFlag-=1,this.countMine+=1):(this.addClassCss(e,t),this.countFlag+=1,this.countMine-=1,this.youWin()),this.changeMineCount())}},{key:"addClassCss",value:function(e,t){e.classList.add(t)}},{key:"openAllMap",value:function(){for(i=0;i<this.gameMap.length;i++)this.arrayOpenCells.indexOf(i)<0&&this.arrayOpenCells.push(i)}}],n&&l(t.prototype,n),e}();function c(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var u=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),h(this,"mouseDown",(function(e){n.button=e.buttons,n.brightnessCell(e)})),h(this,"mouseUp",(function(e){n.gameClickController(e,n.button),n.brightnessCell(e)})),h(this,"getIndexDiv",(function(){})),h(this,"getButton",(function(){})),h(this,"sentBtnSelectGame",(function(){})),h(this,"sendLeftClick",(function(){})),h(this,"sendRightClick",(function(){})),h(this,"sendTwoBtn",(function(){})),this.button,this.gameMapHTML=t}var t,n;return t=e,(n=[{key:"addListenerClick",value:function(){this.gameMapHTML.addEventListener("contexmenu",(function(e){e.preventDefault()})),document.oncontextmenu=function(e){e.preventDefault()},this.gameMapHTML.addEventListener("mousedown",this.mouseDown),this.gameMapHTML.addEventListener("mouseup",this.mouseUp)}},{key:"removeListnerClick",value:function(){this.gameMapHTML.removeEventListener("mousedown",this.mouseDown),this.gameMapHTML.removeEventListener("mouseup",this.mouseUp)}},{key:"brightnessCell",value:function(e){e.target!==this.gameMapHTML&&("mousedown"==e.type?e.target.classList.add("cell_brightness"):e.target.classList.remove("cell_brightness"))}},{key:"gameClickController",value:function(e,t){if(e.target===this.gameMapHTML)return null;if(this.getIndexDiv(e.target)>=0){if(null!==e.target.lastChild)return null;t<3?this.oneButtonClick(e):3==t&&this.twoBtnClick(e)}else{var n=this.getButton(e.target);n>=0&&this.sentBtnSelectGame(n)}}},{key:"oneButtonClick",value:function(e){0==e.button?this.leftButtonClick(e):2==e.button&&this.rightButtonClick(e)}},{key:"twoBtnClick",value:function(e){this.sendTwoBtn(this.getIndexDiv(e.target))}},{key:"leftButtonClick",value:function(e){this.sendLeftClick(this.getIndexDiv(e.target))}},{key:"rightButtonClick",value:function(e){this.sendRightClick(this.getIndexDiv(e.target))}}])&&c(t.prototype,n),e}();function m(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var f=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),d(this,"state",(function(){})),d(this,"onCreateMap",(function(){})),d(this,"onFindCells",(function(){})),d(this,"onFindZeroCells",(function(){})),d(this,"onSendCell",(function(){})),d(this,"onSendFlag",(function(){})),d(this,"onSendCells",(function(){})),d(this,"onSendFirst",(function(){})),d(this,"getCollectionDiv",(function(){})),d(this,"getAllMine",(function(){})),d(this,"onSendEndGame",(function(){})),d(this,"onStartWatch",(function(){})),d(this,"onStopWatch",(function(){})),d(this,"onStopClick",(function(){})),d(this,"onSendSelectGame",(function(){})),d(this,"chooseEasy",(function(){})),d(this,"chooseMedium",(function(){})),d(this,"chooseHard",(function(){})),this.gameSize,this.mapLength,this.quantityMine,this.gameMap=[],this.gameMine=[],this.arrayOpenCells=[],this.arrayFlagCells=[],this.firstClick}var t,n;return t=e,n=[{key:"startGame",value:function(){}},{key:"getState",value:function(){var e=this.state();this.gameSize=e.gameSize,this.quantityMine=e.quantityMine,this.gameMap=e.gameMap,this.gameMine=e.gameMine,this.mapLength=e.mapLength,this.arrayOpenCells=e.arrayOpenCells,this.arrayFlagCells=e.arrayFlagCells,this.firstClick=e.firstClick}},{key:"selectGame",value:function(e){switch(this.onSendSelectGame(!0),e){case 0:this.chooseEasy();break;case 1:this.chooseMedium();break;case 2:this.chooseHard()}}},{key:"checkingCell",value:function(e){this.getState(),null==this.firstClick?(this.firstClick=e,this.arrayOpenCells.push(e),this.onSendFirst(this.firstClick,this.arrayOpenCells),this.onCreateMap(),this.onStartWatch(),0==this.gameMap[e]&&(this.arrayOpenCells=this.arrayOpenCells.concat(this.onFindZeroCells(e))),this.onSendFirst(this.firstClick,this.arrayOpenCells),this.onSendSelectGame(!0)):this.arrayFlagCells.indexOf(e)<0&&this.arrayOpenCells.indexOf(e)<0&&(this.gameMap[e]<0?this.youLose(e):0==this.gameMap[e]?(this.arrayOpenCells=this.arrayOpenCells.concat(this.onFindZeroCells(e)),this.onSendCell(this.arrayOpenCells),this.youWin()):(this.arrayOpenCells.push(e),this.onSendCell(this.arrayOpenCells),this.youWin()))}},{key:"checkingFlag",value:function(e){this.getState(),this.arrayFlagCells.indexOf(e)<0&&this.arrayOpenCells.indexOf(e)<0?this.arrayFlagCells.length<this.quantityMine&&(this.arrayFlagCells.push(e),this.onSendFlag(this.arrayFlagCells),this.youWin()):this.arrayFlagCells.indexOf(e)>=0&&(this.arrayFlagCells.splice(this.arrayFlagCells.indexOf(e),1),this.onSendFlag(this.arrayFlagCells))}},{key:"checkingTwoBtn",value:function(e){var t=this,n=[],i=0,a=this.getCollectionDiv();this.getState(),n=this.onFindCells(e).filter((function(e){if(!a[e].classList.contains("flag"))return e>=0;i+=1})),this.gameMap[e]==i&&n.forEach((function(e){t.checkingCell(e)}))}},{key:"youWin",value:function(){var e=this;if(this.firstClick&&this.gameMine.every((function(t){return e.arrayFlagCells.indexOf(t)>=0&&e.arrayFlagCells.length==e.gameMine.length}))){for(var t=[],n=0;n<this.gameMap.length;n++)t.push(n);this.arrayOpenCells=t,this.onStopWatch(),this.onStopClick(),this.onSendEndGame("win",this.arrayOpenCells)}}},{key:"youLose",value:function(e){this.onStopWatch(),this.onStopClick(),this.arrayOpenCells=this.arrayOpenCells.concat(this.getAllMine()),this.onSendEndGame("lose",this.arrayOpenCells,e)}}],n&&m(t.prototype,n),e}();function g(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var p,v,y,C,M,S,k=function(){function e(){var t,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),n=function(){},(t="onTick")in this?Object.defineProperty(this,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):this[t]=n,this._timerId=null,this._value=0,this._startTime=null,this._tryUpdateEveryMs=1e3}var t,n;return t=e,(n=[{key:"start",value:function(){this._reset(),this._startTime=new Date,this._nextTick()}},{key:"stop",value:function(){this._reset()}},{key:"getValue",value:function(){return this._value}},{key:"_nextTick",value:function(){this._value=new Date-this._startTime,this.onTick(this._value),this._timerId=setTimeout(this._nextTick.bind(this),this._tryUpdateEveryMs)}},{key:"_reset",value:function(){null!=this._timerId&&clearTimeout(this._timerId),this._timerId=null,this._value=0}}])&&g(t.prototype,n),e}(),b=document.getElementById("btnstartgame"),L=document.getElementById("mineMap");b.addEventListener("click",(function(){S.addListenerClick(),p.setNewGame()}));var w=document.getElementById("stopWatch"),O=document.getElementById("countMine");document.getElementById("btnchoise").addEventListener("click",x);var E=document.getElementById("mineMap");function x(){S.addListenerClick(),p.initGame?(p.setSelectGame(!1),p.setNewGame()):(p.addSubscribes(C.watchRender),p.addSubscribes(C.render),p.setGameInited())}function G(e,t,n){E.classList.remove("easy","medium","hard"),p.setNewMap(e,t),p.setSelectGame(!0),E.classList.add(n),v.onStopWatch(),M.createGameMap(p.getState())}p=new t({row:16,column:16},45),v=new f,y=new k,C=new o(L,w,O),M=new s,S=new u(L),M.sendMap=function(e){p.setStateMap(e)},C.render=function(e){C.createGameDiv(e)},C.watchRender=function(e){C.renderWatch(e)},y.onTick=function(e){p.setTimerValue(e,C.watchRender)},S.getIndexDiv=function(e){return C.getIndexDiv(e)},S.sendLeftClick=function(e){v.checkingCell(e)},S.sendRightClick=function(e){v.checkingFlag(e)},S.sendTwoBtn=function(e){v.checkingTwoBtn(e)},S.getButton=function(e){return C.getButton(e)},S.sentBtnSelectGame=function(e){v.selectGame(e)},v.onCreateMap=function(){M.createGameMap(p.getState())},v.onSendCell=function(e){p.setStateLeftClick(e)},v.onSendFlag=function(e){p.setStateRightClick(e)},v.onSendFirst=function(e,t){p.setStateFirstClick(e,t)},v.onSendCells=function(e){p.setStateArray(e)},v.onFindZeroCells=function(e){return M.findSurroundingZero(e)},v.onFindCells=function(e){return M.findSurroundElements(e)},v.state=function(){return p.getState()},v.getCollectionDiv=function(){return C.getCollectionDiv()},v.getAllMine=function(){return M.findAllMine()},v.onSendEndGame=function(e,t,n){p.setStateEndGame(e,t,n)},v.onStartWatch=function(){y.start()},v.onStopWatch=function(){y.stop()},v.onStopClick=function(){S.removeListnerClick()},v.onSendSelectGame=function(e){p.setSelectGame(e)},v.chooseEasy=function(){G({row:9,column:9},10,"easy")},v.chooseMedium=function(){G({row:16,column:16},45,"medium")},v.chooseHard=function(){G({row:16,column:30},99,"hard")},x()})();